# Database Schema (As-Built)

**Version**: 1.0.0
**Database**: PostgreSQL (Supabase)
**Table**: `public.articles`

## 1. Table Structure

| Column | Type | Nullable | Default | Description |
|--------|------|----------|---------|-------------|
| `id` | `uuid` | No | `gen_random_uuid()` | Primary Key |
| `created_at` | `timestamptz` | No | `now()` | Record creation time |
| `title` | `text` | No | - | Article Title (Uniqueness Constraint varies) |
| `link` | `text` | No | - | **Unique Key** for Deduplication |
| `agency` | `text` | No | - | Agency Code (FSC, FSS, MOEF, BOK) |
| `content` | `text` | Yes | - | Full body text (parsed) |
| `published_at` | `timestamptz` | No | - | **KST (UTC+9)** Timestamp of publication |
| `analysis_result`| `jsonb` | Yes | - | AI Analysis Output (See Section 2) |
| `embedding` | `vector(1536)` | Yes | - | **[NOT IMPLEMENTED]** Legacy Placeholder (Empty) |
| `view_count` | `integer` | No | 0 | **[v2.0]** Article View Count |
| `star_rating` | `integer` | Yes | - | **[v2.0]** Manual Rating (1-5) |
| `is_trending` | `boolean` | No | false | **[v2.0]** Trending Status for UI |

---

## 2. JSONB Structure (`analysis_result`)

This JSON object is generated by the AI Analysis Pipeline (`src/services/analyzer.py`).

```json
{
  "is_relevant": boolean,       // Tier 1 Result (Gatekeeper)
  "importance_score": integer,  // 1-5 (Tier 1 estimate or Tier 2 refined)
  "risk_level": string,         // "High", "Medium", "Low"
  "summary": [                  // Bullet points (Tier 2 only)
    "string",
    "string"
  ],
  "impact_analysis": string,    // "Banking Impact" text (Tier 2 only)
  "action_items": [             // Recommended actions (Tier 2 only)
    "string"
  ],
  "keywords": [                 // Extracted keywords
    "string"
  ],
  "filter_reason": string       // Optional explanation if score is low
}
```

## 3. Indexes
- **Primary Key**: `articles_pkey` (id)
- **Unique Index**: `articles_link_key` (link) -> Critical for `_is_duplicate()` check.
- **Index**: `articles_agency_idx` (agency) -> Used by Dashboard filtering.
- **Index**: `articles_published_at_idx` (published_at) -> Used by Dashboard sorting.
